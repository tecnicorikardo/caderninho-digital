# Teste - Despesa de Estoque no Financeiro

## Como Testar

1. **Criar um Novo Produto com Estoque Inicial**
   - V√° em Estoque ‚Üí Novo Produto
   - Preencha:
     - Nome: "Produto Teste"
     - Pre√ßo de Custo: R$ 10,00
     - Pre√ßo de Venda: R$ 20,00
     - Quantidade Inicial: 10
     - Fornecedor: "Fornecedor Teste"
   - Clique em Salvar
   - ‚úÖ Deve criar uma despesa de R$ 100,00 (10 x R$ 10,00) no Financeiro

2. **Editar Produto e Aumentar Quantidade**
   - Edite o produto criado
   - Aumente a quantidade de 10 para 20
   - Clique em Salvar
   - ‚úÖ Deve criar uma despesa adicional de R$ 100,00 (10 x R$ 10,00)

3. **Movimenta√ß√£o de Entrada**
   - Clique em "Movimentar" no produto
   - Selecione "Entrada (Adicionar)"
   - Quantidade: 5
   - Motivo: "Compra adicional"
   - Clique em Confirmar
   - ‚úÖ Deve criar uma despesa de R$ 50,00 (5 x R$ 10,00)

4. **Verificar no Financeiro**
   - V√° em Finan√ßas
   - Verifique se as despesas foram criadas com:
     - Categoria: "Fornecedores"
     - Descri√ß√£o: "Compra de estoque - [Nome do Produto]"
     - Tipo: Despesa
     - Status: Pago

## C√≥digo Atual

A fun√ß√£o `registerStockExpense` est√° implementada em `src/pages/Stock/index.tsx`:

```typescript
const registerStockExpense = async (stockData: {
  productName: string;
  quantity: number;
  costPrice: number;
  supplier: string;
}) => {
  if (!user) return;

  try {
    console.log('üí∞ Registrando despesa de estoque no financeiro...');
    
    const totalCost = stockData.quantity * stockData.costPrice;
    
    // Criar transa√ß√£o financeira
    const financialTransaction = {
      id: `stock_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,
      type: 'despesa',
      category: 'Fornecedores',
      description: `Compra de estoque - ${stockData.productName} (${stockData.quantity}x)`,
      amount: totalCost,
      date: new Date().toISOString(),
      paymentMethod: 'dinheiro',
      status: 'pago',
      userId: user.uid,
      createdAt: new Date().toISOString(),
      financialType: 'comercial',
      autoGenerated: true,
      stockGenerated: true,
      productName: stockData.productName,
      supplier: stockData.supplier
    };

    // Salvar no localStorage (financeiro usa localStorage)
    const savedTransactions = localStorage.getItem(`transactions_${user.uid}`);
    const transactionsList = savedTransactions ? JSON.parse(savedTransactions) : [];
    transactionsList.push(financialTransaction);
    localStorage.setItem(`transactions_${user.uid}`, JSON.stringify(transactionsList));
    
    console.log('‚úÖ Despesa de estoque registrada no financeiro:', financialTransaction.description);
    
    toast.success(`Despesa de R$ ${totalCost.toFixed(2)} registrada no financeiro!`);
    
  } catch (error) {
    console.error('‚ùå Erro ao registrar despesa de estoque:', error);
  }
};
```

## Quando a Despesa √© Registrada

### 1. Criar Novo Produto
```typescript
if (productData.quantity > 0 && productData.costPrice > 0) {
  await registerStockExpense({
    productName: productData.name,
    quantity: productData.quantity,
    costPrice: productData.costPrice,
    supplier: productData.supplier
  });
}
```

### 2. Editar Produto (Aumentar Quantidade)
```typescript
const quantityDifference = productData.quantity - editingProduct.quantity;
if (quantityDifference > 0 && productData.costPrice > 0) {
  await registerStockExpense({
    productName: productData.name,
    quantity: quantityDifference,
    costPrice: productData.costPrice,
    supplier: productData.supplier
  });
}
```

### 3. Movimenta√ß√£o de Entrada
```typescript
if (movementData.type === 'entrada') {
  newQuantity += movementData.quantity;
  
  if (selectedProduct.costPrice > 0) {
    registerStockMovementExpense({
      productName: selectedProduct.name,
      quantity: movementData.quantity,
      costPrice: selectedProduct.costPrice,
      supplier: selectedProduct.supplier,
      reason: movementData.reason
    });
  }
}
```

### 4. Ajuste de Estoque (Aumentar)
```typescript
else { // ajuste
  const quantityDifference = movementData.quantity - selectedProduct.quantity;
  if (quantityDifference > 0 && selectedProduct.costPrice > 0) {
    registerStockMovementExpense({
      productName: selectedProduct.name,
      quantity: quantityDifference,
      costPrice: selectedProduct.costPrice,
      supplier: selectedProduct.supplier,
      reason: `Ajuste de estoque - ${movementData.reason}`
    });
  }
  newQuantity = movementData.quantity;
}
```

## Poss√≠veis Problemas

1. **Pre√ßo de Custo Zero**: Se o produto tiver pre√ßo de custo = 0, a despesa n√£o ser√° registrada
2. **Quantidade Zero**: Se criar produto com quantidade = 0, n√£o registra despesa
3. **Cache do Navegador**: Limpe o cache ou use Ctrl+Shift+R para recarregar
4. **Console do Navegador**: Verifique se h√° erros no console (F12)

## Logs para Verificar

Abra o console do navegador (F12) e procure por:
- `üí∞ Registrando despesa de estoque no financeiro...`
- `‚úÖ Despesa de estoque registrada no financeiro:`
- `‚ùå Erro ao registrar despesa de estoque:`
